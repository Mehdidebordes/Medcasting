pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--main

function _init()
    p={x=3,y=3,spd=0.1,angl=0,rotspeed=0.02,cmp={x=100,y=20,r=5,cl1=6,cl2=5,cl3=8}}
    mkmnp()
end

function _update()
    move_player()
end

function _draw()
    cls()
    rectfill(0,64,128,128,5)
    rectfill(128,64,0,0,8)

    minimap()
    draw_compass()
    draw_walls()
end

-->8
--walls

function draw_walls()
    for pix=1,128 do 
        ratio=(pix-64)/64
        dirx=cos(p.angl)/2+cos(p.angl-0.25)*ratio
        diry=sin(p.angl)/2+sin(p.angl-0.25)*ratio
        mapx=flr(p.x)
        mapy=flr(p.y)
        deltadistx=sqrt(1+(diry^2/dirx^2))
        deltadisty=sqrt(1+(dirx^2/diry^2))
        if(dirx<0) then
            stepx=-1
            sideDistX=(p.x-mapx)*deltadistx
        else
            stepx=1
            sideDistX=(mapx+1-p.x)*deltadistx
        end
        if(diry<0) then
            stepy=-1
            sideDistY=(p.y-mapy)*deltadisty
        else
            stepy=1
            sideDistY=(mapy+1-p.y)*deltadisty
        end
        hit=0
        while(hit==0) do
            if(sideDistY <= 0 or (sideDistX > 0 and sideDistX < sideDistY)) then
                sideDistX+=deltadistx
                mapx+=stepx
                side=0
            else
                sideDistY+=deltadisty
                mapy+=stepy
                side=1
            end
            if(grid[mapy][mapx] !=0) then
                hit=1
            end
        end
        if(side==0) then
            perwalldist = (mapx-p.x+(1-stepx)/2)/dirx
        else 
            perwalldist = (mapy-p.y+(1-stepy)/2)/diry
        end
        wallcolor=(side==0 and 6 or 7)
        line(pix, 64-32/perwalldist,pix,64+32/perwalldist, wallcolor)

    end
end        

-->8
--minimap

function minimap()
    for y=1,grid.hei do
        for x=1,grid.wid do
            if(grid[y][x] == 1) then
                pset(x-1,y-1,5)
            else
                pset(x-1,y-1,7)
            end
        end
    end
    pset(p.x-1,p.y-1,8)
end

function mkmnp()
    grid={}
    grid.wid=0
    grid.hei=0
    while(mget(grid.wid,0) != 0) do
        grid.wid+=1
    end
    while(mget(0,grid.hei) != 0) do
        grid.hei+=1
    end
    for y=0,grid.hei do
        grid[y]={}
        for x=0,grid.wid do
            grid[y][x]=mget(x-1,y-1)
        end
    end
end

-->8
--compass

function draw_compass()
    circfill(p.cmp.x,p.cmp.y,p.cmp.r+2,p.cmp.cl2)
    circfill(p.cmp.x,p.cmp.y,p.cmp.r+1,p.cmp.cl1)
    line(p.cmp.x,p.cmp.y,p.cmp.x+(p.cmp.r*cos(p.angl)),p.cmp.y+(p.cmp.r*sin(p.angl)),p.cmp.cl3)
end


-->8
--player
function move_player()
    if(btn(0)) then
        p.angl+=p.rotspeed
    end
    if(btn(1)) then
        p.angl-=p.rotspeed
    end
    if(btn(2)) then
        calculate_player_movement(1)
    end
    if(btn(3)) then
        calculate_player_movement(-1)
    end
end

function calculate_player_movement(ne)
    tmpx=p.x+(p.spd*cos(p.angl))*ne
    if(grid[flr(p.y)][flr(tmpx)] == 0) then
        p.x=tmpx
    end
    tmpy=p.y+(p.spd*sin(p.angl))*ne
    if(grid[flr(tmpy)][flr(p.x)] == 0) then
        p.y=tmpy
    end
end

__gfx__
00000000555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700566666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000566666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000566666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700566666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000566666650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb00bb00bb0bbb0bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b000b000b0b0b0b0b0000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbb0b000b0b0bb00bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000b0b000b0b0b0b0b0000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bb000bb0bb00b0b0bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b0b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b0b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b0b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000001111000000000000000111100000000000000001111000000000000000111100000000000000001111000000000000000111100000000000000
0000000000001cccc100000000000001cccc1000000000000001cccc100000000000001cccc1000000000000001cccc100000000000001cccc10000000000000
000000000001c8cc8c1000000000001c8cc8c10000000000001c8cc8c1000000000001c8cc8c10000000000001c8cc8c1000000000001c8cc8c1000000000000
000000000001ccddcc1000000000001ccddcc10000000000001ccddcc1000100000001ccddcc10000000000001ccddcc1000000000001ccddcc1000000000000
000000000001c8cc8c1000000000001c8cc8c10000000000001c8cc8c1000000000001c8cc8c10000000000001c8cc8c1000000000001c8cc8c1000000000000
0000000000001cccc100000000000001cccc1000000000000001cccc100000000000001cccc1000000000000001cccc100000000000001cccc10000000000000
0000000000000c00c006000000000000c00c0000000000000000c00c000000000000000c00c0000000000000000c00c000000000000000c00c00000000000000
000000000000c1000c0000000000000c0000c00000000000000c0000c0000000000000c0000c00000000000000c0000c0000000000000c0000c0000000000000
00000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000c00c00000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000cccc00000000000000000000000000000000000000000000000000000000000000
00000000000010000000000000000000000000000000000000000000000000c17c00000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000cc11cc0000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000c1111c0000000000000000000000000000000000000000000000000000007000000
0000000000000000000000000000000000000000000000000000000000001cc11cc1000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000600000000000000000000001cccccc1000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000090000009000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000
00000000000000000000000000000000000000000000060000000000000000000000000000000100000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000001010000000101010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000101010101000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000001000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000001000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000300502e05029050230501d050160500c05006050020300103009030000300002000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000026610056002d6001a7001970019700197002c3002c3001c0001f0002c3002d3002d300300002b3000060029300086002830023000000001f0001f0000000000000000000000000000000000000000000
001000002a0502a0502f0502d0502a0501e0501a0501b050290501e05021050230502805026050260502505027050210501d050180502605015050160501f050250500000000000260500000000000260501d000
001000001d15024150261502c15034100331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
